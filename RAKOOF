-- LocalScript：L 開啟/關閉循環刪除 Torso + 循環傳送
--              O 立即傳送到 The_Rake 模型位置（不需 Torso/HumanoidRootPart）
-- 放在 StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

local featureEnabled = false -- L 鍵循環開關

-- 函式：取得地圖中所有 The_Rake 模型
local function getRakeModels()
	local rakes = {}
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj.Name == "The_Rake" then
			table.insert(rakes, obj)
		end
	end
	return rakes
end

-- 函式：刪除 The_Rake 的 Torso
local function removeTorso(rake)
	if not rake then return end
	local torso = rake:FindFirstChild("Torso")
	if torso then
		torso:Destroy()
		print("已刪除 The_Rake 的 Torso。")
	end
end

-- 函式：傳送玩家到 The_Rake
local function teleportToRake(rake)
	if not rake then return end
	-- 取模型的 PrimaryPart，如果沒有就取模型的 Position（CFrame）
	local targetCFrame
	if rake.PrimaryPart then
		targetCFrame = rake.PrimaryPart.CFrame
	else
		targetCFrame = CFrame.new(rake:GetModelCFrame().p) -- 使用模型中心
	end
	rootPart.CFrame = targetCFrame + Vector3.new(0,5,0) -- 偏移 5 避免卡住
end

-- 每幀循環（L 開關控制）
RunService.RenderStepped:Connect(function()
	if featureEnabled then
		local rakes = getRakeModels()
		for _, rake in ipairs(rakes) do
			-- 循環刪除 Torso
			removeTorso(rake)
			-- 循環傳送玩家
			teleportToRake(rake)
		end
	end
end)

-- 按鍵監聽
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
	if gameProcessedEvent then return end
	if input.KeyCode == Enum.KeyCode.L then
		featureEnabled = not featureEnabled
		print("循環刪除 Torso + 玩家傳送功能已 " .. (featureEnabled and "開啟" or "關閉"))
	elseif input.KeyCode == Enum.KeyCode.O then
		-- 按 O 立即傳送到第一個找到的 The_Rake
		local rakes = getRakeModels()
		if #rakes > 0 then
			teleportToRake(rakes[1])
			print("已立即傳送到 The_Rake。")
		else
			print("找不到 The_Rake。")
		end
	end
end)
