local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")

-- UI 建立 (同之前)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ScratchCardGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 420, 0, 320)
frame.Position = UDim2.new(0.5, -210, 0.5, -160)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = screenGui

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -20, 0, 40)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.new(1, 1, 1)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 28
titleLabel.Text = "卡片號碼：等待資料..."
titleLabel.Parent = frame

local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, -20, 0, 200)
scrollingFrame.Position = UDim2.new(0, 10, 0, 60)
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollingFrame.ScrollBarThickness = 8
scrollingFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
scrollingFrame.BorderSizePixel = 0
scrollingFrame.Parent = frame

local templateLabel = Instance.new("TextLabel")
templateLabel.Size = UDim2.new(1, 0, 0, 30)
templateLabel.BackgroundTransparency = 0.5
templateLabel.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
templateLabel.BorderSizePixel = 0
templateLabel.TextColor3 = Color3.new(1, 1, 1)
templateLabel.Font = Enum.Font.SourceSans
templateLabel.TextSize = 20
templateLabel.TextXAlignment = Enum.TextXAlignment.Left
templateLabel.Visible = false
templateLabel.Parent = scrollingFrame

local openButton = Instance.new("TextButton")
openButton.Size = UDim2.new(0, 140, 0, 50)
openButton.Position = UDim2.new(0.5, -70, 1, -60)
openButton.BackgroundColor3 = Color3.fromRGB(200, 40, 40)
openButton.TextColor3 = Color3.new(1, 1, 1)
openButton.Font = Enum.Font.SourceSansBold
openButton.TextSize = 24
openButton.Text = "開啟卡片"
openButton.Parent = frame

local tweenInfo = TweenInfo.new(0.7, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

local currentNumber = nil

local function displayCardData(data)
    scrollingFrame:ClearAllChildren()
    templateLabel.Parent = scrollingFrame

    for i, v in ipairs(data) do
        local item = templateLabel:Clone()
        item.Name = "Item_" .. i
        item.Text = tostring(i) .. ". " .. tostring(v)
        item.Visible = true
        item.Position = UDim2.new(0, 0, 0, 30 * (i - 1))
        item.Parent = scrollingFrame
    end

    scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, #data * 30)
end

local function fadeIn()
    screenGui.Enabled = true
    frame.BackgroundTransparency = 1
    local tween = TweenService:Create(frame, tweenInfo, {BackgroundTransparency = 0})
    tween:Play()
end

local function fadeOut(callback)
    local tween = TweenService:Create(frame, tweenInfo, {BackgroundTransparency = 1})
    tween:Play()
    tween.Completed:Connect(function()
        if callback then
            callback()
        end
    end)
end

-- 模擬資料
local mockData = {
    "卡片項目A",
    "卡片項目B",
    "卡片項目C",
    "卡片項目D",
    "卡片項目E",
}

local mockNumber = 123456

-- 顯示UI主函式
local function showScratchCardUI(data, number)
    currentNumber = number
    titleLabel.Text = "卡片號碼：" .. tostring(number)
    displayCardData(data)
    fadeIn()
end

openButton.MouseButton1Click:Connect(function()
    print("[ScratchCard] 點擊開啟卡片，數字:", currentNumber)
    fadeOut(function()
        screenGui:Destroy()
    end)
    -- 這邊你可以加FireServer事件呼叫
end)

-- 直接呼叫顯示UI
showScratchCardUI(mockData, mockNumber)
