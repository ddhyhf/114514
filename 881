local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local events = ReplicatedStorage:WaitForChild("Events")
local scratchCard = events:WaitForChild("ScratchCard")

local newCardEvent = scratchCard:WaitForChild("NewCard")
local openCardEvent = scratchCard:WaitForChild("OpenCard")

-- 建立簡易UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ScratchCardGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 400, 0, 250)
frame.Position = UDim2.new(0.5, -200, 0.5, -125)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.Parent = screenGui

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, -20, 0, 40)
label.Position = UDim2.new(0, 10, 0, 10)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.new(1, 1, 1)
label.Font = Enum.Font.SourceSansBold
label.TextSize = 32
label.Text = "等待卡片資料..."
label.Parent = frame

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 140, 0, 50)
button.Position = UDim2.new(0.5, -70, 1, -60)
button.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
button.TextColor3 = Color3.new(1, 1, 1)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 24
button.Text = "開啟卡片"
button.Parent = frame
button.AutoButtonColor = true

local currentNumber = nil

button.MouseButton1Click:Connect(function()
    if currentNumber then
        print("[ScratchCard] 觸發開啟卡片，數字:", currentNumber)
        openCardEvent:FireServer(currentNumber)
        screenGui:Destroy()
    else
        print("[ScratchCard] 尚未收到卡片數字，無法開啟。")
    end
end)

newCardEvent.OnClientEvent:Connect(function(cardData, myNumber)
    print("[ScratchCard] 收到卡片資料:", cardData, myNumber)
    currentNumber = myNumber
    label.Text = "你的卡號: " .. tostring(myNumber)
    -- 這裡你可以自行擴展顯示 cardData
end)
